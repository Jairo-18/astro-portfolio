---
import { Image } from 'astro:assets';
import logo from '../../assets/images/logo.png';
---

<!-- Configuración inicial del tema para evitar parpadeos -->
<script>
  if (
    localStorage.getItem('color-theme') === 'ligth' ||
    (!('color-theme' in localStorage) &&
      window.matchMedia('(prefers-color-scheme: dark)').matches)
  ) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark');
  }
</script>
<div class="nav-bar">
  <div
    class="w-full flex justify-between items-center px-3 py-3 m-0 shadow-lg bg-white dark:bg-gray-900 dark:text-white"
  >
    <div class="flex items-center justify-start">
      <Image src={logo} alt="Logo" class="h-16 w-auto" />
      <a
        type="button"
        role="button"
        href="/"
        class="hidden lg:block px-4 py-2 lg:px-0 text-black dark:text-white hover:text-blue-500/80 text-lg font-semibold"
      >
        Jhon Legarda
      </a>
      <span
        class="lg:hidden block px-2 text-black dark:text-white font-semibold"
      >
        Jhon Legarda
      </span>
    </div>
    <div>
      <button
        id="theme-toggle"
        type="button"
        class="mt-4 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5"
      >
        <svg
          id="theme-toggle-dark-icon"
          class="hidden w-5 h-5"
          fill="currentColor"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
          ></path>
        </svg>
        <svg
          id="theme-toggle-light-icon"
          class="hidden w-5 h-5"
          fill="currentColor"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
            fill-rule="evenodd"
            clip-rule="evenodd"></path>
        </svg>
        <span class="mr-3">Modo oscuro</span>
      </button>
    </div>
    <!-- Menú de navegación en desktop -->
    <nav class="hidden flex-row gap-x-10 opacity-90 md:flex">
      <a href="/" class="hover:text-blue-500/80 dark:hover:text-blue-400 active"
        >Inicio</a
      >
      <a
        href="/projects"
        class="hover:text-blue-500/80 dark:hover:text-blue-400">Proyectos</a
      >
      <a
        href="/education"
        class="hover:text-blue-500/80 dark:hover:text-blue-400">Educación</a
      >
      <a
        href="/about-me"
        class="hover:text-blue-500/80 dark:hover:text-blue-400">Sobre mi</a
      >
      <a href="/contact" class="hover:text-blue-500/80 dark:hover:text-blue-400"
        >Contacto</a
      >
    </nav>

    <!-- Botón para abrir el menú móvil -->
    <div class="flex items-center justify-center m-0 p-3 md:hidden">
      <nav class="md:hidden bg-white dark:bg-gray-900 dark:text-white">
        <button
          id="dropdownDefaultButton"
          data-dropdown-toggle="dropdown"
          onclick="toggleDropdown()"
          class="text-black dark:text-white font-medium rounded-lg text-sm px-4 py-2.5 text-center inline-flex items-center dark:bg-gray-800 dark:hover:bg-gray-700"
          type="button"
        >
          <svg
            class="w-5 h-5"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <rect x="3" y="6" width="18" height="2" fill="#000"></rect>
            <rect x="3" y="11" width="18" height="2" fill="#000"></rect>
            <rect x="3" y="16" width="18" height="2" fill="#000"></rect>
          </svg>
        </button>

        <!-- Menú desplegable -->
        <div class="flex justify-end w-full">
          <div
            id="dropdown"
            class="z-10 hidden absolute mx-auto bg-white dark:bg-gray-800 divide-y divide-gray-100 rounded-lg shadow w-44 mt-2"
          >
            <ul
              class="py-2 text-sm text-dark dark:text-white"
              aria-labelledby="dropdownDefaultButton"
            >
              <li>
                <a
                  href="/"
                  class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:hover:text-white"
                  onclick="toggleDropdown()">Inicio</a
                >
              </li>
              <li>
                <a
                  href="/projects"
                  class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:hover:text-white"
                  onclick="toggleDropdown()">Proyectos</a
                >
              </li>
              <li>
                <a
                  href="/education"
                  class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:hover:text-white"
                  onclick="toggleDropdown()">Educación</a
                >
              </li>
              <li>
                <a
                  href="/about-me"
                  class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:hover:text-white"
                  onclick="toggleDropdown()">Sobre mi</a
                >
              </li>
              <li>
                <a
                  href="/contact"
                  class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:hover:text-white"
                  onclick="toggleDropdown()">Contacto</a
                >
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
  </div>
</div>

<script is:inline>
  const isMobile = window.innerWidth <= 768;

  window.addEventListener('scroll', function () {
    const header = document.getElementById('dynamicHeader');
    if (window.scrollY > 50 && !isMobile) {
      header.classList.remove('bg-transparent');
      header.classList.add('bg-neutral-950/50', 'backdrop-blur-2xl');
    } else {
      header.classList.remove('bg-neutral-950/50', 'backdrop-blur-2xl');
      header.classList.add('bg-transparent');
    }
  });

  function toggleDropdown() {
    const dropdown = document.getElementById('dropdown');
    dropdown.classList.toggle('hidden');
  }
</script>

<script>
  // Función para inicializar el toggle del tema
  function initializeThemeToggle() {
    const themeToggleDarkIcon = document.getElementById(
      'theme-toggle-dark-icon',
    );
    const themeToggleLightIcon = document.getElementById(
      'theme-toggle-light-icon',
    );
    const themeToggleBtn = document.getElementById('theme-toggle');

    // Configura íconos iniciales
    if (
      localStorage.getItem('color-theme') === 'dark' ||
      (!localStorage.getItem('color-theme') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      themeToggleLightIcon?.classList.remove('hidden');
    } else {
      themeToggleDarkIcon?.classList.remove('hidden');
    }

    // Agregar listener al botón
    themeToggleBtn?.addEventListener('click', () => {
      themeToggleDarkIcon?.classList.toggle('hidden');
      themeToggleLightIcon?.classList.toggle('hidden');

      if (localStorage.getItem('color-theme') === 'light') {
        document.documentElement.classList.add('dark');
        localStorage.setItem('color-theme', 'dark');
      } else {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('color-theme', 'light');
      }
    });
  }

  // Inicializa el toggle cuando la página carga
  initializeThemeToggle();

  // Re-inicializa el toggle después de un cambio de ruta
  document.addEventListener('astro:after-swap', initializeThemeToggle);
</script>
